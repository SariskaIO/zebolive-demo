<style>
    .content-container {
        width: 100%;
        padding: 0;
    }



    body,
    .navbar-default,
    .wo_about_wrapper_parent {
        padding-right: 390px;
    }

    .wow_go_live_btn {
        right: 302px !important;
        top: 60px !important;
        z-index: 1 !important;
    }

    .wow_end_live_btn {
        right: 302px !important;
        top: 60px !important;
        z-index: 1 !important;
    }

    .box_color {
        background-color: #fff;
        padding: 8px 8px !important;
        margin: 10px;
    }

    .img_box img {
        border-radius: 10px;
    }

    .avatar_img {
        margin-top: 10px;
    }

    .avatar_img img {
        border-radius: 50%;
        width: 49px;
        height: 49px;
    }

    .name {
        margin: 10px 8px;
    }

    .wo_sidebar_activity_live {
        font-family: Segoe UI Historic, Segoe UI, Helvetica, Arial, sans-serif;
        font-size: 15px;
        font-weight: bold;
        text-align: left;
        margin-top: 6px;
    }

    .notification-list {
        padding: 7px 0px 0px !important;
    }

    .card_box_live {
        /* width: 75%; */
        margin: 15px;
    }

    svg.feather {
        vertical-align: middle;
        margin-top: -10px;
        margin-right: 5px;
        width: 22px !important;
        height: 16px !important;
    }

    .conatiner-fluid.live_background {
        background-color: #000;
        width: 100%;
        min-height: 92vh;
        /* max-height: 100vh; */
        /* height: 100%; */
        /* overflow: hidden; */
    }

    .video_flex {
        /* margin: 20px; */
        height: 100%;
        padding: 20px;
    }

    .two_screen {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        /* align-items: center; */
        /* height: 100%; */
    }

    .two_screen .video_name {
        width: calc(50% - 10px);
        height: 295px;
        display: inline-block;
    }

    .two_screen .video_name video {
        height: 295px;
        width: 100%;
    }

    .four_screen {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        height: 100%;
    }

    .four_screen .video_name {
        width: 49.8%;
        height: 295px;
        display: inline-block;
        margin-top: 5px;
    }

    .four_screen .video_name video {
        height: 100%;
        object-fit: cover;
    }

    .six_screen {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        height: 100%;
    }

    .six_screen .video_name {
        width: 33%;
        height: 295px;
        display: inline-block;
        margin-top: 5px;
    }

    .six_screen .video_name video {
        height: 100%;
        object-fit: cover;
    }


    .video_name .video_tag {
        position: relative;
        height: 100%;
    }

    .img_gif {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #9139399c;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .img_gif img {
        width: 30%;
    }


    .chat_main.live_chat_main {
        position: fixed;
        bottom: 0;
        /* top: 0; */
        width: 390px;
        color: #333;
        /* height: 100%; */
        z-index: 9;
        border-radius: 10px 10px 0 0;
        right: 0;
        box-shadow: 0 12px 28px 0 rgb(0 0 0 / 5%), 0 2px 10px 0 rgb(0 0 0 / 4%);
    }

    .video_chat_container {
        width: 390px !important;
    }

    .wow_go_live_btn {
        right: 405px !important;
        top: 60px !important;
        z-index: 1 !important;
    }

    @media screen and (max-width:767px) {
        .conatiner-fluid.live_background {
            /* height: 100vh; */
            /* overflow: auto; */
        }

        /* .video_flex {
			margin: 20px;
			height: 94%;
		} */
        .video_flex {
            margin: 0px 10px;
            height: 100%;
            padding: 20px 0;
        }

        .six_screen .video_name {
            width: 49.5%;
            height: 177px;
        }

        .four_screen .video_name {
            width: 49.5%;
            height: 177px;
        }

        .wow_go_live_btn {
            right: 15px !important;
        }

        .wow_go_live_btn,
        .wow_end_live_btn {
            min-width: 90px;
            line-height: 34px;
        }

        .four_screen .video_name {
            width: 49.5%;
            height: 262px;
        }

        .two_screen .video_name {
            width: 100%;
            height: 100%;
            display: inline-block;
        }
    }
</style>
<div class="livestreamingAlert"></div>

<button class="btn btn-mat btn-success start_vdo_call wow_go_live_btn" onclick="Live()"><svg
        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path fill="currentColor"
            d="M17,14.5V11A1,1 0 0,0 16,10H4A1,1 0 0,0 3,11V21A1,1 0 0,0 4,22H16A1,1 0 0,0 17,21V17.5L21,21.5V10.5M3,3.86L4.4,5.24C7.5,2.19 12.5,2.19 15.6,5.24L17,3.86C13.14,0.05 6.87,0.05 3,3.86M5.8,6.62L7.2,8C8.75,6.5 11.25,6.5 12.8,8L14.2,6.62C11.88,4.34 8.12,4.34 5.8,6.62Z">
        </path>
    </svg> Go Live</button>

<a class="btn btn-mat end_vdo_call wow_end_live_btn" onclick="EndLive()" style="display: none;">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <path fill="currentColor"
            d="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z">
        </path>
    </svg> End live</a>


<input type="hidden" name="roomname" id="roomname" value="mytest">

<!-- Include the Phoenix.js script -->
<script src="https://sdk.sariska.io/bundle.messaging.js"></script>
<script type="text/javascript" src="https://sdk.sariska.io/umd/sariska-media-transport.min.js"></script>


<div class="conatiner-fluid live_background">
    <div class="video_flex ">
        <div class="two_screen" style="display: block;">
            <div class="video_name">
                <video playsInline="1" autoPlay='1' id="videoElement0" class="video" width="100%"></video>
                <audio playsInline="1" autoPlay='1' id="audioElement"></audio>
            </div>
            <div class="video_name">
                <div class="video_tag">
                    <video playsInline="1" autoPlay='1' id="videoElement1" class="video sub1" width="100%"></video>
                    <audio playsInline="1" autoPlay='1' id="audioElement"></audio>
                    <div class="img_gif img_gif1">
                        <img src="assets/call-gif.gif" />
                    </div>
                </div>
            </div>
            <div class="video_name">
                <div class="video_tag">
                    <video playsInline="1" autoPlay='1' id="videoElement2" class="video" width="100%"></video>
                    <audio playsInline="1" autoPlay='1' id="audioElement"></audio>
                    <div class="img_gif">
                        <img src="assets/call-gif.gif" />
                    </div>
                </div>
            </div>
            <div class="video_name">
                <div class="video_tag">
                    <video playsInline="1" autoPlay='1' id="videoElement3" class="video" width="100%"></video>
                    <audio playsInline="1" autoPlay='1' id="audioElement"></audio>
                    <div class="img_gif">
                        <img src="assets/call-gif.gif" />
                    </div>
                </div>
            </div>
        </div>
			<div class="video_name">
				<video playsInline="1" autoPlay='1' id="videoElement0" class="video" width="100%"></video>
				<audio playsInline="1" autoPlay='1' id="audioElement"></audio>
			</div>
			<div class="video_name">
				<div class="video_tag">
					<video playsInline="1" autoPlay='1' id="videoElement1" class="video sub1" width="100%"></video>
					<audio playsInline="1" autoPlay='1' id="audioElement"></audio>
					<div class="img_gif img_gif1">
						<img src="assets/call-gif.gif" />
					</div>
				</div>
			</div>
			<div class="video_name">
				<div class="video_tag">
					<video playsInline="1" autoPlay='1' id="videoElement2" class="video sub2" width="100%"></video>
					<audio playsInline="1" autoPlay='1' id="audioElement"></audio>
					<div class="img_gif img_gif2">
						<img src="assets/call-gif.gif" />
					</div>
				</div>
			</div>
			<div class="video_name">
				<div class="video_tag">
					<video playsInline="1" autoPlay='1' id="videoElement3" class="video sub3" width="100%"></video>
					<audio playsInline="1" autoPlay='1' id="audioElement"></audio>
					<div class="img_gif img_gif3">
						<img src="assets/call-gif.gif" />
					</div>
				</div>
			</div>

			<div class="video_name">
				<div class="video_tag">
					<video playsInline="1" autoPlay='1' id="videoElement4" class="video sub4" width="100%"></video>
					<audio playsInline="1" autoPlay='1' id="audioElement"></audio>
					<div class="img_gif4 img_gif">
						<img src="assets/call-gif.gif" />
					</div>
				</div>
			</div>
			<div class="video_name">
				<div class="video_tag">
					<video playsInline="1" autoPlay='1' id="videoElement5" class="video sub5" width="100%"></video>
					<audio playsInline="1" autoPlay='1' id="audioElement"></audio>
					<div class="img_gif img_gif5">
						<img src="assets/call-gif.gif" />
					</div>
				</div>
			</div>
		</div>
    </div>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
    integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    let isLive = true;
    var remoteIds = [];
    let roomname = '';
    let key = 0;
    const myId = '';
    $(document).ready(function () {
        $(".sub").hide();

        // if (isLive) {
        //     meet();
        // }
    });

    const getToken = async () => {
        const body = {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                apiKey: "229409aabecb0d532636d1e132a7bd8479c15bfcddef269c27d2b6",// enter your app secret
                user: {  // optional
                    id: "2212",
                    name: "nick",
                    email: "nick@gmail.com",
                    avatar: "https://test.com/user/profile.jpg",
                    moderator: false // if participant is moderator pass true or leave it blank , sariska will automatically elect first participant as moderator if moderator leaves sariska promote someone else as a moderator.
                }
            })
        };
        try {
            const response = await fetch("https://api.sariska.io/api/v1/misc/generate-token", body);
            if (response.ok) {
                const json = await response.json();
                return json.token;
            } else {
                console.log(response.status);
            }
        } catch (error) {
            console.log('error', error);
        }
    }


    async function meet() {

        const options = {
            devices: ["video"],
            resolution: 2160, // 180,  240,  360, vga, 480, qhd, 540, hd, 720, fullhd, 1080, 4k, 2160
        }

        SariskaMediaTransport.initialize();
        const token = await getToken();
        console.log(token);


        //roomname = $("#roomname").val();
        roomname = "roomtest"
        console.log('roomname', roomname)

        const connection = new SariskaMediaTransport.JitsiConnection(token, roomname, false);
        connection.addEventListener(
            SariskaMediaTransport.events.connection.CONNECTION_ESTABLISHED,
            () => {
                createConference(connection);
            }
        );

        connection.addEventListener(SariskaMediaTransport.events.connection.CONNECTION_FAILED, (error) => {
            if (error === SariskaMediaTransport.events.connection.PASSWORD_REQUIRED) { // token expired set again
                console.log('connection disconnect!!!', error);
            }
        });

        connection.addEventListener(SariskaMediaTransport.events.connection.CONNECTION_DISCONNECTED, (error) => {
            console.log('connection disconnect!!!', error);
        });

        connection.connect();
    }

    const createConference = async (connection) => {

        const conference = await connection.initJitsiConference();

        const options = {
            devices: ["audio", "video"],
            resolution: 720, // 180,  240,  360, vga, 480, qhd, 540, hd, 720, fullhd, 1080, 4k, 2160
        }

        const localTracks = await SariskaMediaTransport.createLocalTracks(options);

        conference.join();

        conference.addEventListener(
            SariskaMediaTransport.events.conference.USER_ROLE_CHANGED,
            (id) => {
                console.log("first");
                if (conference.isModerator()) {
                    console.log("is Moderator");
                    if (conference.isJoined()) {
                        console.log("is joined");
                        conference.enableLobby();
                    }
                }
            }
        );

        conference.addEventListener(SariskaMediaTransport.events.conference.LOBBY_USER_JOINED, async (id, name) => {
            console.log("Lobby user joinded");
            console.log("Name: ", name);
            console.log("id: ", id);

            // Display the confirmation box
            var result = confirm('Are you sure you want to proceed?');

            // Check the user's choice
            if (result) {
                // User clicked OK, proceed with the action
                console.log('Action confirmed!');
                conference.lobbyApproveAccess(id);
            } else {
                // User clicked Cancel, do nothing
                console.log('Action canceled!');
            }
        })

        const audioTrack = localTracks.find(track => track.getType() === "audio");

        console.log("audioTrack", audioTrack);

        const videoTrack = localTracks.find(track => track.getType() === "video");

        // to play video

        videoTrack.attach(document.getElementById("videoElement0"))

        // to play audio

        audioTrack.attach(document.getElementById("audioElement"))

        const remoteTracks = [];

        conference.addEventListener(
            SariskaMediaTransport.events.conference.CONFERENCE_JOINED,
            () => {
                localTracks.forEach((track) => {
                    conference.addTrack(track)
                });
            }
        );

        // Use this to remove references of videoelements
        conference.addEventListener(SariskaMediaTransport.events.conference.TRACK_REMOVED, function (track) {
            if (track.getType() === "video") {
                key = key - 1;
            }
        });

        conference.addEventListener(SariskaMediaTransport.events.conference.TRACK_ADDED, function (track) { 
            if (track.isLocal()) {
                console.log("Track is local");
                return
            }else if(track.bot){

            } 
            else {
                console.log("Track is remote");
                if (track.getType() === "video") {
                    key = key + 1;
                    console.log("Key: ", key);
                    remoteIds.push(track.getParticipantId());
                    $(".img_gif" + key).hide();
                    $(".sub" + key).show();
                    track.attach(document.getElementById("videoElement" + key));
                }
            }
        });

        conference.addEventListener(SariskaMediaTransport.events.conference.USER_JOINED, function (id, participant) {
            console.log("user joined!!!", participant);
        });
    }

    function Live() {
        $(".wow_go_live_btn").prop('disabled', true);

        isLive = true;
        meet();

    }
</script>